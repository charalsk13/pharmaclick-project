<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="utf-8" />
  <title>Î§Î¬ÏÏ„Î·Ï‚ Î¦Î±ÏÎ¼Î±ÎºÎµÎ¯Ï‰Î½</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body style="margin: 0; padding: 0;">
  <div id="map" style="width: 100%; height: 100vh;"></div>

  <script>
    // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Leaflet Ï‡Î¬ÏÏ„Î·
    const map = L.map('map').setView([38.2466, 21.7346], 13);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    // Î£Ï…Î½Î¬ÏÏ„Î·ÏƒÎ· Ï€Î¿Ï… ÎºÎ±Î»ÎµÎ¯Ï„Î±Î¹ Î±Ï€ÏŒ JavaFX
    window.setPharmacies = function(pharmacies) {
      console.log("ğŸ“¦ Î•ÎºÏ„ÎµÎ»ÎµÎ¯Ï„Î±Î¹ setPharmacies:", pharmacies);

      pharmacies.forEach(pharmacy => {
        // ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ ÎµÎ³ÎºÏ…ÏÏŒÏ„Î·Ï„Î±Ï‚ ÏƒÏ…Î½Ï„ÎµÏ„Î±Î³Î¼Î­Î½Ï‰Î½
        if (!pharmacy.coords || pharmacy.coords.length !== 2 ||
            pharmacy.coords[0] == null || pharmacy.coords[1] == null) {
          console.warn("âŒ Î‘Î³Î½ÏŒÎ·ÏƒÎ± Ï†Î±ÏÎ¼Î±ÎºÎµÎ¯Î¿ Î¼Îµ Î¬ÎºÏ…ÏÎµÏ‚ ÏƒÏ…Î½Ï„ÎµÏ„Î±Î³Î¼Î­Î½ÎµÏ‚:", pharmacy);
          return;
        }

        const marker = L.marker(pharmacy.coords).addTo(map);
        marker.bindPopup(`<b>${pharmacy.name}</b><br>${pharmacy.info}`);

        marker.on('click', () => {
          console.log("ğŸŸ¢ Î Î¬Ï„Î·ÏƒÎµÏ‚ Ï„Î¿ marker:", pharmacy.name);

          
            if (window.javaApp && typeof window.javaApp.openPharmacy === 'function') {
              console.log("âœ… ÎšÎ±Î»ÎµÎ¯Ï„Î±Î¹ javaApp.openPharmacy Î³Î¹Î±:", pharmacy.name);
              window.javaApp.openPharmacy(pharmacy.name);
            } else {
              console.warn("âŒ Î— javaApp Î® Î· Î¼Î­Î¸Î¿Î´Î¿Ï‚ openPharmacy Î´ÎµÎ½ ÎµÎ¯Î½Î±Î¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î·.");
            }
           // Î¼Î¹ÎºÏÎ® ÎºÎ±Î¸Ï…ÏƒÏ„Î­ÏÎ·ÏƒÎ· Î³Î¹Î± Î±ÏƒÏ†Î¬Î»ÎµÎ¹Î±
        });
      });
    };

    // Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î¸Î­ÏƒÎ·Ï‚ Ï‡ÏÎ®ÏƒÏ„Î· Î±Î½ ÎµÏ€Î¹Ï„ÏÎ­ÏˆÎµÎ¹ Ï„Î¿ browser
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(position => {
        const userCoords = [position.coords.latitude, position.coords.longitude];
        L.marker(userCoords, {
          icon: L.icon({
            iconUrl: 'https://cdn-icons-png.flaticon.com/512/684/684908.png',
            iconSize: [30, 41],
            iconAnchor: [15, 41]
          })
        }).addTo(map).bindPopup("Î— Ï„Î¿Ï€Î¿Î¸ÎµÏƒÎ¯Î± Î¼Î¿Ï…").openPopup();

        map.setView(userCoords, 14);
      });
    }
  </script>
</body>
</html>
